{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///D:/Dokumen/Anti%20Gravity/Scrapping_YT_Website/lib/utils.ts"],"sourcesContent":["import { clsx, type ClassValue } from \"clsx\"\nimport { twMerge } from \"tailwind-merge\"\n\nexport function cn(...inputs: ClassValue[]) {\n    return twMerge(clsx(inputs))\n}\n\nexport function extractVideoID(url: string): string | null {\n    const regex =\n        /(?:https?:\\/\\/)?(?:www\\.)?(?:min_y|youtu\\.be\\/|youtube\\.com\\/)(?:embed\\/|v\\/|watch\\?v=|shorts\\/|live\\/)?([a-zA-Z0-9_-]{11})/;\n    const match = url.match(regex);\n    return match ? match[1] : null;\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEO,SAAS,GAAG,GAAG,MAAoB;IACtC,OAAO,IAAA,wKAAO,EAAC,IAAA,+IAAI,EAAC;AACxB;AAEO,SAAS,eAAe,GAAW;IACtC,MAAM,QACF;IACJ,MAAM,QAAQ,IAAI,KAAK,CAAC;IACxB,OAAO,QAAQ,KAAK,CAAC,EAAE,GAAG;AAC9B"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///D:/Dokumen/Anti%20Gravity/Scrapping_YT_Website/app/api/scrape/route.ts"],"sourcesContent":["import { google } from \"googleapis\";\r\nimport { NextResponse } from \"next/server\";\r\nimport { extractVideoID } from \"@/lib/utils\";\r\n\r\nexport async function POST(req: Request) {\r\n    try {\r\n        const { youtubeUrl, limit, apiKey } = await req.json();\r\n\r\n        if (!apiKey) {\r\n            return NextResponse.json(\r\n                { error: \"API Key is missing. Please check your settings.\" },\r\n                { status: 401 }\r\n            );\r\n        }\r\n\r\n        if (!youtubeUrl) {\r\n            return NextResponse.json(\r\n                { error: \"YouTube URL is required.\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const videoId = extractVideoID(youtubeUrl);\r\n        if (!videoId) {\r\n            return NextResponse.json(\r\n                { error: \"Invalid YouTube URL. Could not extract Video ID.\" },\r\n                { status: 400 }\r\n            );\r\n        }\r\n\r\n        const maxComments = Math.min(Math.max(Number(limit) || 10, 10), 2000); // Clamp between 10 and 2000\r\n\r\n        const youtube = google.youtube({\r\n            version: \"v3\",\r\n            auth: apiKey,\r\n        });\r\n\r\n        let allComments: any[] = [];\r\n        let nextPageToken: string | undefined = undefined;\r\n        let totalRetrieved = 0;\r\n\r\n        // First, fetch video details to get title/channel\r\n        const videoResponse = await youtube.videos.list({\r\n            part: [\"snippet\", \"statistics\"],\r\n            id: [videoId],\r\n        });\r\n\r\n        const videoDetails = videoResponse.data.items?.[0];\r\n        if (!videoDetails) {\r\n            return NextResponse.json(\r\n                { error: \"Video not found or API Key is invalid.\" },\r\n                { status: 404 }\r\n            );\r\n        }\r\n\r\n        const videoMeta = {\r\n            title: videoDetails.snippet?.title,\r\n            channel: videoDetails.snippet?.channelTitle,\r\n            thumbnail: videoDetails.snippet?.thumbnails?.high?.url,\r\n            total_comments: videoDetails.statistics?.commentCount,\r\n        };\r\n\r\n        // Loop for comments\r\n        while (totalRetrieved < maxComments) {\r\n            const remaining = maxComments - totalRetrieved;\r\n            // API max result per page is 100\r\n            const maxResults = Math.min(remaining, 100);\r\n\r\n            try {\r\n                const response: any = await youtube.commentThreads.list({\r\n                    part: [\"snippet\"],\r\n                    videoId: videoId,\r\n                    maxResults: maxResults,\r\n                    pageToken: nextPageToken,\r\n                    textFormat: \"plainText\",\r\n                    order: \"relevance\",\r\n                });\r\n\r\n                const items = response.data.items || [];\r\n\r\n                for (const item of items) {\r\n                    const snippet = item.snippet?.topLevelComment?.snippet;\r\n                    if (snippet) {\r\n                        allComments.push({\r\n                            author_name: snippet.authorDisplayName,\r\n                            text_display: snippet.textDisplay,\r\n                            like_count: snippet.likeCount,\r\n                            published_at: snippet.publishedAt,\r\n                            is_reply: false, // For simplicity in this v1, we focus on top-level threads\r\n                        });\r\n                    }\r\n                }\r\n\r\n                totalRetrieved += items.length;\r\n                nextPageToken = response.data.nextPageToken || undefined;\r\n\r\n                if (!nextPageToken || items.length === 0) {\r\n                    break;\r\n                }\r\n            } catch (err: any) {\r\n                console.error(\"YouTube API Error:\", err);\r\n                // If it's a quota or auth error, stop and return what we have or error\r\n                if (err.code === 403 || err.code === 400) {\r\n                    throw err; // Propagate to outer catch\r\n                }\r\n                break;\r\n            }\r\n        }\r\n\r\n        return NextResponse.json({\r\n            meta: videoMeta,\r\n            comments: allComments,\r\n        });\r\n\r\n    } catch (error: any) {\r\n        console.error(\"Scrape Error:\", error);\r\n\r\n        let status = 500;\r\n        let message = \"Internal Server Error\";\r\n\r\n        // Handle Google API Errors\r\n        if (error.code === 400 || error.code === 403) {\r\n            // Check for specific reasons if available in the error object structure\r\n            // googleapis often returns errors with a structure like error.errors[0].reason\r\n            const reason = error.errors?.[0]?.reason;\r\n\r\n            if (reason === 'keyInvalid' || error.message?.includes('API key not valid')) {\r\n                status = 401;\r\n                message = \"Invalid API Key, please check settings.\";\r\n            } else if (reason === 'quotaExceeded') {\r\n                status = 429;\r\n                message = \"YouTube API Quota Exceeded. Please try again later or use a different key.\";\r\n            } else {\r\n                status = error.code;\r\n                message = error.message || \"YouTube API Error\";\r\n            }\r\n        } else if (error.code && typeof error.code === 'number') {\r\n            status = error.code;\r\n            message = error.message;\r\n        }\r\n\r\n        return NextResponse.json({ error: message }, { status });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}